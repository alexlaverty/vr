<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Teleportation in A-Frame for Oculus Quest</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-extras.controls@3.3.0/dist/aframe-extras.controls.min.js"></script>
  <script src="https://unpkg.com/aframe-teleport-controls/dist/aframe-teleport-controls.min.js"></script>

</head>
<body>
  <a-scene>

<!-- Basic movement and teleportation  -->
      <a-entity id="cameraRig" movement-controls="constrainToNavMesh: true;" navigator="cameraRig: #cameraRig; cameraHead: #head; collisionEntities: .collision; ignoreEntities: .clickable" position="0 0 0" rotation="0 0 0">
        <!-- camera -->
        <a-entity id="head" camera="active: true" position="0 1.6 0" look-controls="pointerLockEnabled: true; reverseMouseDrag: true" ></a-entity>
              <!-- Left Controller -->
              <a-entity id="leftHand" hand-controls="hand: left; handModelStyle: lowPoly; color: #15ACCF" teleport-controls="cameraRig: #cameraRig; teleportOrigin: #head; button: trigger; curveShootingSpeed: 18; landingMaxAngle: 60" visible="true"></a-entity>
              <!-- Right Controller -->
              <a-entity id="rightHand" hand-controls="hand: right; handModelStyle: lowPoly; color: #15ACCF" laser-controls raycaster="showLine: true; far: 10; interval: 0; objects: .clickable, a-link;" line="color: #7cfc00; opacity: 0.5" visible="true"></a-entity>
      </a-entity>

    <!-- Ground plane -->
    <a-plane
      src="https://cdn.aframe.io/a-painter/images/floor.jpg"
      rotation="-90 0 0"
      width="20"
      height="20"
    ></a-plane>

    <!-- Simple box to teleport to when clicked -->
    <a-box
      color="tomato"
      position="0 1 -5"
      scale="2 2 2"
      cursor-listener
      navigate-on-click="target: #rig"
    ></a-box>
  </a-scene>

  <script>
    AFRAME.registerComponent('oculus-quest-controls', {
      init: function () {
        const self = this;
        const { sceneEl } = this.el;

        // Register the teleport-controls component for Oculus Quest
        sceneEl.systems['tracked-controls-webxr'].registerComponent('oculus-touch', {
          schema: AFRAME.utils.extend({}, AFRAME.components['oculus-touch'].schema, {
            hand: { default: 'left' },
            button: { default: 'trigger' },
            model: { default: false }
          }),

          onButtonChanged: function (evt) {
            const button = this.data.button;
            const isPressed = evt.detail.state === 'pressed';
            if (button === 'trigger' && isPressed) {
              self.el.setAttribute('teleport-controls', {
                type: 'parabolic',
                button: 'trigger',
                collisionEntities: '#rig',
                cameraRig: '#rig'
              });
            }
          }
        });
      }
    });
  </script>
</body>
</html>
